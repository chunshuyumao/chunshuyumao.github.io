

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head><!-- hexo injector head_begin start --><script src="/chage_cdn.js"></script><!-- hexo injector head_begin end -->
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/csym.png">
  <link rel="icon" href="/img/csym.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="椿树与猫">
  <meta name="keywords" content="">
  
    <meta name="description" content="使用 Pandoc 将 Markdown 转换到 DOCX 和 HTML 格式">
<meta property="og:type" content="article">
<meta property="og:title" content="Pandoc: 从 Markdown 到其他格式">
<meta property="og:url" content="https://chunshuyumao.github.io/2022/11/20/Pandoc-%E4%BB%8E-Markdown-%E5%88%B0%E5%85%B6%E4%BB%96%E6%A0%BC%E5%BC%8F/">
<meta property="og:site_name" content="椿树与猫">
<meta property="og:description" content="使用 Pandoc 将 Markdown 转换到 DOCX 和 HTML 格式">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-11-20T01:15:43.000Z">
<meta property="article:modified_time" content="2022-11-23T11:00:01.424Z">
<meta property="article:author" content="椿树与猫">
<meta property="article:tag" content="Markdown">
<meta property="article:tag" content="Pandoc">
<meta name="twitter:card" content="summary_large_image">
  
  
  <title>Pandoc: 从 Markdown 到其他格式 - 椿树与猫</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/shades-of-purple.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"chunshuyumao.github.io","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":"§"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>椿树与猫</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://cdn.jsdelivr.net/gh/chunshuyumao/202203bf@master/2021-07-24.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Pandoc: 从 Markdown 到其他格式">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-11-20 09:15" pubdate>
        2022年11月20日 上午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      7.1k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      30 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Pandoc: 从 Markdown 到其他格式</h1>
            
            <div class="markdown-body">
              <h1 id="前言">前言</h1>
<p><a target="_blank" rel="noopener" href="https://markdown.com.cn/">Markdown</a>
是一种轻量级的标记语言，可以在纯文本文档中添加格式化元素。Markdown
最大的特点就是专注于文字，而且因为纯文本格式，可以纳入版本管理。日常使用的
DOCX
格式是二进制格式，没法进行版本管理。纯文本意味着只要是一个编辑器便可以打开并对
Markdown 进行编辑和查看。</p>
<blockquote>
<p>二进制无法进行版本管理指的是，无法查看版本之间的区别，并非直接加入版本管理。</p>
</blockquote>
<p>写作的时候，可以先使用 Markdown
进行写作，然后转换成其他需要的格式，实现一个文件满足多种格式，避免一点点修改原格式。转换格式必不可少
<a target="_blank" rel="noopener" href="https://Pandoc.org">Pandoc</a>
，一款支持多格式转换的工具。现在很多的 Markdown 编辑器基本依赖的就是
Pandoc。了解如何使用 Pandoc 可以控制自己的 Markdown
输出格式，更随心所欲。之前自己使用 <a
target="_blank" rel="noopener" href="https://Zettlr.com">Zettlr</a>，Zettlr 帮解决了大部分的 Pandoc
问题，所以没有太在意 Pandoc。现在从 Zettlr 脱离出来，开始探究 Pandoc
的使用。由此，今天就是要对 Pandoc 做一个介绍，主要针对的是如何配合
Markdown 转化成 DOCX 格式和 HTML
格式。前者一般是学生必须的格式，所以必须得介绍；后者是用 Markdown
写作时的日常预览。</p>
<h1 id="pandoc-安装">Pandoc 安装</h1>
<p><a target="_blank" rel="noopener" href="https://Pandoc.org">Pandoc</a>
被称作文件格式转换的瑞士军刀，非常锐利简便，如果对细节要求不高，一般来说一行命令就可以完成许多格式之间的转换。介绍过
Markdown 的，基本都会说到 Pandoc，似乎这两者便是天生的一对。</p>
<p>Pandoc
是一个命令行工具，所以下载、安装之后是无法打开图形界面的，甚至看不到命令行界面。<a
target="_blank" rel="noopener" href="https://pandoc.org/installing.html">官网</a>
有介绍如何进行安装，不过我更喜欢在 <a
target="_blank" rel="noopener" href="https://github.com/jgm/pandoc/releases/latest">GitHub</a>
上直接下载。</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120095003.png" srcset="/img/loading.gif" lazyload
alt="GitHub 上最新的 Pandoc 对应各个系统的软件包" /></p>
<p>安装完之后需要进行环境变量的设置，方便在命令行打开。如果使用官网推荐的方式进行安装，即使用包管理器安装，一般在命令行上可以直接运行，只需要打开命令行即可。在
Linux 和 MacOS
上可以找一个叫做终端(Terminal)的软件，点击即可进入命令行模式；在 Windows
系统上则可选择 CMD 或者 Powershell。Pandoc 导出 DOCX 文件格式使用
Powershell 有毛病，会出现乱码，所以推荐使用 CMD。因此 Windows
系统可以打开搜索找到叫做 <code>命令行</code> 的软件，打开即可。</p>
<p>打开命令行之后在命令行上输入 <code>pandoc --version</code> (Windows
系统使用的 Pandoc 命令是
<code>pandoc.exe --version</code>，后面所有指令在 Windows 上都写作
<code>pandoc.exe</code> 而非
<code>pandoc</code>)出现类似以下的界面则表示没问题：</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120100023.png" srcset="/img/loading.gif" lazyload
alt="Pandoc 安装成功" /></p>
<h2 id="环境变量配置">环境变量配置</h2>
<p>如果得到的提示是 <code>某某命令找不到(Not Found)</code> 或者
<code>未知命令</code> 这类错误，那说明环境没有配好，比如手动到 GitHub
下载。如果是手动下载，下载后的包需要解压缩(zip,
tar.gz)，解压之后放到指定的地方，然后进行环境变量的配置。</p>
<h3 id="linux-配置">Linux 配置</h3>
<p>在 Linux 上可以放到 <code>~/.local/bin/</code>
文件夹里面。首先打开命令行，输入 <code>ls ~/.local/bin</code>
查看路径是否存在。如果提示:</p>
<blockquote>
<p>命令行中需要输入的命令会使用 <code>$</code>
标注起来，没有其他说明默认非 <code>$</code>
开头的都是命令的输出结果。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> ~/.local/bin<br><span class="hljs-built_in">ls</span>: cannot access <span class="hljs-string">&#x27;/home/chunshuyumao/.local/bin&#x27;</span>: No such file or directory<br></code></pre></div></td></tr></table></figure>
<p>类似的错误提示，说明你的路径下没有这些文件夹。这时候可以输入
<code>mkdir -p ~/.local/bin</code>，直接创建多级文件夹。找到自己下载的
Pandoc 的压缩包，一般是 <code>tar.gz</code> 结尾。然后 <code>ls</code>
确实有这个文件，输入 <code>tar</code> 指令进行解压。如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span><br>Desktop    Downloads   Music          Pictures  Templates  Zotero<br>Documents  miniconda3  pandoc.tar.gz  Public    Videos<br>$ tar -zxvf pandoc.tar.gz -C ~/.local/bin<br>pandoc<br></code></pre></div></td></tr></table></figure>
<p>其中 <code>-C</code> 表示解压的位置。在自己的命令行配置文件
<code>.bashrc</code> 中写下 <code>PATH=$HOME/.local/bin:$PATH</code>
，关闭命令行，重新打开试试 <code>pandoc --version</code>。</p>
<blockquote>
<p>如果使用的其他的 Shell，例如 Zsh、Ksh 等，就需要在特定的配置文件
<code>.zshrc</code> 和 <code>.kshrc</code> 进行配置。</p>
</blockquote>
<p>如果进行这些配置之后还是出现错误，那请重头开始。</p>
<h3 id="windows-配置">Windows 配置</h3>
<p>如果是 Windows，直接解压放到任何一个目录，比如放到
<code>D:\Applications\Pandoc</code> 文件夹。打开 <code>系统属性</code>
界面，可以使用 Windows 自带的搜索直接搜 <code>系统属性</code>
几个大字。打开之后选择
<code>高级-&gt;环境变量-&gt;系统变量-&gt;Path(或者PATH)</code> ，双击
<code>Path</code> 选择新建，输入自己的 Pandoc
放到的位置，选择确定即可。</p>
<h1 id="pandoc-使用">Pandoc 使用</h1>
<p>安装好 Pandoc 之后就可以进行简单的使用了，接下来我会使用 Linux
进行演示，但是所有操作在 Windows 的 CMD 上一样适用。</p>
<p>首先创建一个 Markdown 文件作为演示，文件拓展名是
<code>.md</code>。以下是用于演示的 Markdown 文件的内容：</p>
<figure class="highlight markdown"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># Markdown 语法</span><br><br><span class="hljs-emphasis">*拉丁文斜体*</span> 正字<br><br><span class="hljs-strong">**着重加粗**</span> 无所谓<br><br><span class="hljs-strong">**<span class="hljs-emphasis">*拉丁文斜体加粗*</span>**</span> 无所谓的正字<br><br><span class="hljs-quote">&gt;</span><br><span class="hljs-quote">&gt; 子曰：我没说过</span><br><span class="hljs-quote">&gt;</span><br><span class="hljs-quote"></span><br><span class="hljs-quote">[<span class="hljs-string">Markdown</span>](<span class="hljs-link">https://markdown.com.cm</span>) 网址</span><br><br>![<span class="hljs-string">高清大图</span>](<span class="hljs-link">https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120110320.png</span>)<br><br>|姓名|学号|年龄|<br>|:----:|:----:|:----:|<br>|张三|001|18|<br>|李四|003|17|<br>|王五|004|18|<br>: 花名单<br><br><span class="hljs-section">## 二级标题</span><br><br></code></pre></div></td></tr></table></figure>
<p>打开命令行，确认路径下有我们的 Markdown
文件。然后进行转化。转化时输出文件用 <code>-o outout.format</code>
表示，<code>-o</code> 是 <code>--output</code> 的缩写。</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span><br>test.md<br>$ pandoc test.md -o test.html<br>$ pandoc test.md -o test.docx<br>$ <span class="hljs-built_in">ls</span><br>test.md test.html test.docx<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>完整写法应该是
<code>pandoc --from markdown --to html test.md -o test.html</code>.
如果不指定类型，Pandoc 会通过扩展名自动判断。转换到 DOCX的完整写法是
<code>pandoc --from markdown --to docx test.md -o test.html</code>。也可以使用更短的命令
<code>pandoc -f markdown -t html test.md -o test.html</code></p>
</blockquote>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120111452.gif" srcset="/img/loading.gif" lazyload
alt="动图演示" /></p>
<p>使用 WPS 或者 Office 打开 DOCX 文件查看，效果好像还行。</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120111820.png" srcset="/img/loading.gif" lazyload
alt="Markdown 转换成的 DOCX 文件" /></p>
<p>同理使用 浏览器打开 HTML
文件。平心而论，很丑，丑的不行，根本看不下去。</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120112104.png" srcset="/img/loading.gif" lazyload
alt="Markdown 转换成的 HTML 文件" /></p>
<p>这不全怪 Pandoc，是我们的操作有问题。因为有些格式不止由一个 Markdown
文件生成，而是多个文件组合。如果转换成 HTML 只使用一个文件，我们需要告诉
Pandoc 我们只需要一个文件，所以转换成 HTML 的正确操作应该是：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ pandoc -s test.md -o test.html<br></code></pre></div></td></tr></table></figure>
<p>命令中的 <code>-s</code> 是 <code>--standalone</code>
的缩写，表示单文件模式，不需要多个源文件组合。再看看转换之后的文件：</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120112602.png" srcset="/img/loading.gif" lazyload
alt="使用单文件模式转换成 HTML 格式" /></p>
<p>这次的转换就很好看了。我开了暗夜模式所以网页看起来是黑的，其实是白的。</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120112732.png" srcset="/img/loading.gif" lazyload
alt="正常情况下的预览" /></p>
<p>转换成 DOCX 的时候也需要单文件模式，但是 Pandoc 默认加上了。默认的
HTML 模板其实蛮好看，没啥需要改的。仔细看，转换单文件模式的 HTML
时，命令行还出现了这样的提示：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ pandoc -s test.md -o test.html<br>[WARNING] This document format requires a nonempty &lt;title&gt; element.<br>  Defaulting to <span class="hljs-string">&#x27;test&#x27;</span> as the title.<br>    To specify a title, use <span class="hljs-string">&#x27;title&#x27;</span> <span class="hljs-keyword">in</span> metadata or --metadata title=<span class="hljs-string">&quot;...&quot;</span>.<br></code></pre></div></td></tr></table></figure>
<p>这提示我们可以给文件加一个标题，语法是
<code>--metadata title="标题"</code>。可以用 <code>-M</code> 代替冗长的
<code>--metadata</code> 命令，在命令行加。我们试试：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ pandoc -s -M title=<span class="hljs-string">&quot;Convert from Markdown to HTML&quot;</span> test.md -o test.html<br></code></pre></div></td></tr></table></figure>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120113424.png" srcset="/img/loading.gif" lazyload
alt="添加标题" /></p>
<p>可以看到，渲染的网页给我们添加了标题:</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120113457.png" srcset="/img/loading.gif" lazyload
alt="网页添加标题" /></p>
<p>同理转换成 DOCX 看看：</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120113702.png" srcset="/img/loading.gif" lazyload
alt="DOCX 添加标题" /></p>
<p>只是使用基本的语法到这里就差不多了，要使用其他功能就需要继续往下看。</p>
<h1 id="pandoc-进阶">Pandoc 进阶</h1>
<p>进阶部分我们会介绍如何使用 Pandoc
进行文献引用、链接，自动给标题标号、分章节，修改链接格式，甚至图片、表格、公式交叉引用、导出格式等等，也会使用到其他的工具，到时会细说。</p>
<h2 id="文献引用">文献引用</h2>
<p>这里的引用(citation)指的是写论文时的参考文献，与 <code>&gt;</code>
代表的直接引用名人名言不同。可以在官网上看到有关引用的介绍。有什么问题最好也是官网查看，到处在网上搜属实是下下策。</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120124611.png" srcset="/img/loading.gif" lazyload
alt="官网上对引用的介绍" /></p>
<p>从官网上了解到，想要引用需要：</p>
<ol type="1">
<li>包含引用的文件，比如我们的论文 Markdown 格式。</li>
<li>参考文献(bibliography)源文件，可以是参考文献文件，也可以使用
<code>-M</code> 标注。用 <code>-M</code>
标注太低级了，后面的演示会直接使用 <a
target="_blank" rel="noopener" href="https://www.Zotero.org">Zotero</a> 导出的文献库。</li>
<li>CSL 引用格式文件。这是可选的。</li>
<li>使用 <code>--citeproc</code> 进行参考文献的引用处理。</li>
</ol>
<p>参考文献格式有多个类别，可查看下表。Pandoc
处理参考文献时会把其他格式转换成 JSON ，所以为了简便可以直接使用 JSON
格式，少了中间商。那就准备文献库吧。</p>
<table>
<caption>参考文献格式</caption>
<thead>
<tr class="header">
<th style="text-align: center;">格式</th>
<th style="text-align: center;">扩展名</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">BibLaTex</td>
<td style="text-align: center;">.bib</td>
</tr>
<tr class="even">
<td style="text-align: center;">BibTex</td>
<td style="text-align: center;">.bibtex</td>
</tr>
<tr class="odd">
<td style="text-align: center;">CSL JAON</td>
<td style="text-align: center;">.json</td>
</tr>
<tr class="even">
<td style="text-align: center;">CSL YAML</td>
<td style="text-align: center;">.yaml</td>
</tr>
<tr class="odd">
<td style="text-align: center;">RIS</td>
<td style="text-align: center;">.ris</td>
</tr>
</tbody>
</table>
<h3 id="从-zotero-中导出文献库">从 Zotero 中导出文献库</h3>
<p>导出文献库需要下载 Zotero 作为文献管理器，然后需要的文献放到 Zotero
中。Zotero 是一个大命题，这里不会过多介绍，如有兴趣可以看看之前写的文章
<a href="/2022/03/15/Zotero%E6%96%87%E7%8C%AE%E7%AE%A1%E7%90%86%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85/" title="Zotero文献管理插件安装">Zotero文献管理插件安装</a>。安装 <a
target="_blank" rel="noopener" href="https://retorque.re/zotero-better-bibtex/">Better BibTex for
Zotero</a> 插件方便使用
<code>citationkey</code>。<code>citationkey</code> 是 Pandoc
实现引用的关键东东，就像 DOI(digital object unique
identifier，数字对象唯一标识符) 一样，每一篇文献都有一个对应的
<code>citationkey</code>，独一无二。</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120130813.png" srcset="/img/loading.gif" lazyload
alt="citationkey" /></p>
<p>安装好插件之后就要导出文献库。Zotero 里打开
<code>文件(File) -&gt; 导出库(Export Library)</code>，选择
<code>Better CSL JSON</code> 格式，然后勾选
<code>保持更新(Keep updated)</code>，<code>OK</code>
即可。如果没有这个格式，建议看看是不是没有安装 Better BibTex
这个插件。保存到一个指定目录，我保存到
<code>/home/chunshuyumao/Documents/Pandoc/ZoteroLibrary.json</code>，后面要用到。</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/202211161958383.png" srcset="/img/loading.gif" lazyload
alt="选择导出文献库" /></p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/202211162000373.png" srcset="/img/loading.gif" lazyload
alt="选择格式，保持更新" /></p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/202211162011533.png" srcset="/img/loading.gif" lazyload
alt="保存到某个目录" /></p>
<p>文献库是一个 JSON
格式的文件，可以打开瞧瞧。下面展示的是文件中的信息，截了一篇文献的信息。</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/202211162045423.png" srcset="/img/loading.gif" lazyload
alt="一篇文献的引用信息" /></p>
<p>Pandoc 识别引用的语法是 <code>[@citationkey]</code>。意思是在
Markdown 文件中引用一篇文献需要这样写：</p>
<figure class="highlight markdown"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs markdown">这是文章内容，巴拉巴拉巴拉。研究[@AlfredRodrigo-1702]认为巴拉巴拉巴拉。<br></code></pre></div></td></tr></table></figure>
<p>Pandoc 渲染之后自动标号，而且在后面生成了参考文献。</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/202211162058293.png" srcset="/img/loading.gif" lazyload
alt="Pandoc 渲染后" /></p>
<p>需要注意的是，如果没有给 Pandoc 指定文献格式(Citation Style
language，CSL) ，Pandoc 默认使用 Chicago Manual of Style。格式可以到
Zotero
中下载。一般来说，国内使用的是国标(GB)，至于哪个版本就看需求了，我一般用
2005 年的 numeric. 下载之后的 CSL 文件在 Zotero 安装位置下的 styles
文件夹。</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/202211162108573.png" srcset="/img/loading.gif" lazyload
alt="下载格式" /></p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/202211162111253.png" srcset="/img/loading.gif" lazyload
alt="CSL 位置" /></p>
<p>复制想要用的 CSL 文件到某个位置，这里复制到和文献库同一位置，即
<code>/home/chunshuyumao/Documents/Pandoc</code>。</p>
<h3 id="使用引用">使用引用</h3>
<p>准备好文献库，在我们的 Markdown 文件中添加以下行：</p>
<figure class="highlight markdown"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section">## 二级标题</span><br><br>这里即将引用一篇文献[@DefiningCellTypes]。是的没错。<br><br></code></pre></div></td></tr></table></figure>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120133037.png" srcset="/img/loading.gif" lazyload
alt="全文如上" /></p>
<p>Pandoc 将 Markdown 转换到 HTML 并使用引用，除了文献库和 CSL
文件，还需要加上 <code>--citeproc</code> 进行处理，所以语法如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ pandoc -s -M title=<span class="hljs-string">&quot;Convert from Markdown to HTML&quot;</span> --citeproc --bibliography /path/to/lib.json --csl /path/to/style.csl test.md -o test.html<br></code></pre></div></td></tr></table></figure>
<p>上面的命令行太长，我们可以使用换行，让它看起来更正常一点：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ pandoc -s \<br>  -M title=<span class="hljs-string">&quot;Convert from Markdown to HTML&quot;</span> \<br>  --citeproc \<br>  --bibliography /path/to/lib.json \<br>  --csl /path/to/style.csl \<br>  test.md \<br>  -o test.html<br></code></pre></div></td></tr></table></figure>
<p>这样看起来舒服多了。同理，把 <code>test.html</code> 换成
<code>test.docx</code> 就可以生成 DOCX 格式了。</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120133530.png" srcset="/img/loading.gif" lazyload
alt="命令行转换" /></p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120133641.png" srcset="/img/loading.gif" lazyload
alt="HTML 格式效果" /></p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120133758.png" srcset="/img/loading.gif" lazyload
alt="DOCX 格式效果" /></p>
<p>初步完成了引用，写论文一般要求引用可以点击跳转。这个也可以做到，只需要添加
<code>-M link-citations=true</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ pandoc -s \<br>  -M title=<span class="hljs-string">&quot;Convert from Markdown to HTML&quot;</span> \<br>  -M link-citations=<span class="hljs-literal">true</span> \<br>  --citeproc \<br>  --bibliography /path/to/lib.json \<br>  --csl /path/to/style.csl \<br>  test.md \<br>  -o test.html<br></code></pre></div></td></tr></table></figure>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120134937.gif" srcset="/img/loading.gif" lazyload
alt="动图演示点击跳转" /></p>
<p>这里有个毛病，点击跳转的 DOCX 文件在 WPS Office 中没办法跳转，但在
Microsoft Office 中没问题。可能使用的 Linux 版 WPS
有问题，因为手机版也可以跳转。</p>
<h2 id="自动给标题标号">自动给标题标号</h2>
<p>处理完文献我们希望，导出的 HTML 和 DOCX
的标题自动给标题标号，这种东西没必要手动操作，直接让 Pandoc
处理。查看官网，想让 Pandoc 标号只需要添加一行命令 <code>-N</code> 或者
<code>--number-sections</code>。</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120135849.png" srcset="/img/loading.gif" lazyload
alt="自动标号" /></p>
<p>好家伙，叠 Buff 开始：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ pandoc -s \<br>  -M title=<span class="hljs-string">&quot;Convert from Markdown to HTML&quot;</span> \<br>  -M link-citations=<span class="hljs-literal">true</span> \<br>  -N \<br>  --citeproc \<br>  --bibliography /path/to/lib.json \<br>  --csl /path/to/style.csl \<br>  test.md \<br>  -o test.html<br></code></pre></div></td></tr></table></figure>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120140103.png" srcset="/img/loading.gif" lazyload
alt="自动标号成功" /></p>
<p>后面我会用 HTML 演示，DOCX 和 HTML 差不多，有区别时我才会单独拎出
DOCX，否则操作共享。</p>
<h2 id="交叉引用">交叉引用</h2>
<p>写论文不免使用图片、公式和表格，特别是 <code>如图几</code>
这类的语句。如果原本你有三张图，并且已经标好号了，论文内有五个
<code>如图几</code>。不想你又在开头添加一张图片。这时候你需要更改所有的
<code>如图几</code>，因为在开头添加图片就把原来的标号顺序全都弄错了。为了避免这种情况，我们一般选择交叉引用。坏消息是
Markdown 和 Pandoc 都不支持交叉引用，好消息是有一个 Pandoc
插件可以支持。这个插件就是 <a
target="_blank" rel="noopener" href="https://github.com/lierdakil/pandoc-crossref">Pandoc-crossref</a>。</p>
<h3 id="下载-pandoc-crossref">下载 Pandoc-crossref</h3>
<p>先到 <a
target="_blank" rel="noopener" href="https://github.com/lierdakil/pandoc-crossref/releases">GitHub</a>
下载 Pandoc-crossref。注意下载时版本对应，看看自己的 Pandoc
是什么版本，使用 <code>pandoc --version</code> 查看。我的是
<code>2.19.2</code> 可以直接下载最新的 Pandoc-crossref。不同版本编译的
Pandoc-crossref 一般不能交叉使用。</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120142401.png" srcset="/img/loading.gif" lazyload
alt="Pandoc-crossref 下载" /></p>
<p>下载完成后建议和 Pandoc
放一起方便管理。如果使用的是不同的目录，比如你不愿把它们放到一起，那请记住位置，并为
Pandoc-crossref 设置环境变量，否则下面使用 Pandoc-crossref
需要带上全路径。</p>
<blockquote>
<p>全路径指的是，把文件的绝对路径写上。配置环境变量本质上就是免了写全路径。</p>
</blockquote>
<h3 id="使用-pandoc-crossref">使用 Pandoc-crossref</h3>
<p>可以查看 Pandoc-crossref 的 <a
target="_blank" rel="noopener" href="https://lierdakil.github.io/pandoc-crossref/">用法</a>
。这里我会说明基本用法。首先是最常用的图片引用，语法如下：</p>
<figure class="highlight markdown"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs markdown">![<span class="hljs-string">图片注释</span>](<span class="hljs-link">图片路径</span>)&#123;#fig:id&#125;<br></code></pre></div></td></tr></table></figure>
<p>正文中使用引用只需用 <code>[@fig:id]</code>
即可。格式和参考文献的引用一样，参考文献由 <code>--citeproc</code>
处理，为了避免 Pandoc 把交叉引用当作参考文献解析，我们需要在使用
<code>--citeproc</code> 之前使用 pandoc-crossref, 命令行语法为
<code>--filter pandoc-crossref</code>。<code>id</code>
是一个拉丁字母的组合，不可使用中文、数字和下标等等。如下为图示:</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120143501.png" srcset="/img/loading.gif" lazyload
alt="图片引用" /></p>
<p>注意，一定要在使用 <code>--citeproc</code> 之前使用
pandoc-crossref。</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ pandoc -s \<br>  -M title=<span class="hljs-string">&quot;Convert from Markdown to HTML&quot;</span> \<br>  -M link-citations=<span class="hljs-literal">true</span> \<br>  -N \<br>  --filter pandoc-crossref \<br>  --citeproc \<br>  --bibliography /path/to/lib.json \<br>  --csl /path/to/style.csl \<br>  test.md \<br>  -o test.html<br></code></pre></div></td></tr></table></figure>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120143827.png" srcset="/img/loading.gif" lazyload
alt="导出效果" /></p>
<p>Pandoc 渲染引用的图片标号用 <code>fig.</code>
代替，并在图片注释前添加 <code>Figure.</code>。中文写作想使用
<code>图</code> 而不是 <code>fig</code> 怎么办？添加
<code>-M figPrefix="图"</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ pandoc -s \<br>  -M title=<span class="hljs-string">&quot;Convert from Markdown to HTML&quot;</span> \<br>  -M link-citations=<span class="hljs-literal">true</span> \<br>  -N \<br>  -M figPrefix=<span class="hljs-string">&quot;图&quot;</span> \<br>  --filter pandoc-crossref \<br>  --citeproc \<br>  --bibliography /path/to/lib.json \<br>  --csl /path/to/style.csl \<br>  test.md \<br>  -o test.html<br></code></pre></div></td></tr></table></figure>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120145040.png" srcset="/img/loading.gif" lazyload
alt="修改前缀" /></p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120144908.png" srcset="/img/loading.gif" lazyload
alt="修改引用的前缀" /></p>
<p>想把图注释中的 <code>Figure</code> 也改中文？野心不小嘛，添加
<code>-M figureTitle="图"</code>。同理，公式、表格的用法也一样，甚至还有章节、列表的引用，见下表：</p>
<div>

<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120145251.png" srcset="/img/loading.gif" lazyload /></p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120145517.png" srcset="/img/loading.gif" lazyload /></p>
Pandoc-crossref 支持的交叉引用(部分)
<div>

<p>在 Markdown 文件中添加如下引用：</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120153534.png" srcset="/img/loading.gif" lazyload
alt="使用交叉引用" /></p>
<p>命令行输入</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ pandoc -s \<br>  -M title=<span class="hljs-string">&quot;Convert from Markdown to HTML&quot;</span> \<br>  -M link-citations=<span class="hljs-literal">true</span> \<br>  -M figPrefix=<span class="hljs-string">&quot;图&quot;</span> \<br>  -M figureTitle=<span class="hljs-string">&quot;图&quot;</span> \<br>  -M tblPrefix=<span class="hljs-string">&quot;表&quot;</span> \<br>  -M tableTitle=<span class="hljs-string">&quot;表&quot;</span> \<br>  -M eqnPrefix=<span class="hljs-string">&quot;公式&quot;</span> \<br>  -N \<br>  --filter pandoc-crossref \<br>  --citeproc \<br>  --bibliography /path/to/lib.json \<br>  --csl /path/to/style.csl \<br>  test.md \<br>  -o test.html<br></code></pre></div></td></tr></table></figure>
<p>效果如 <code>交叉引用1</code> 和
<code>交叉引用2</code>。想必有人发现不同了，图 2 的表格和图片都标上了
<code>1.1</code> 表示第一章的第一张图，而图 1 没有。这是因为我加了分章节
<code>-M chapters=ture</code>，这样图片和公式可以按照章节(其实就是标题)来划分，且第一张图的数学公式没有渲染。这个不急，后面会说怎么渲染数学公式。</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120152620.png" srcset="/img/loading.gif" lazyload
alt="交叉引用1" /></p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120152413.png" srcset="/img/loading.gif" lazyload
alt="交叉引用2" /></p>
<p>至此，交叉引用已经完成了，该解决数学公式了。</p>
<h2 id="数学公式">数学公式</h2>
<p>Pandoc 渲染数学公式需要借助外力。Pandoc
渲染数学公式需要显式指定渲染引擎。如下</p>
<ol type="1">
<li>mathjax</li>
<li>mathml</li>
<li>webtex</li>
<li>katex</li>
<li>gladtex</li>
</ol>
<p>这几个有好有坏，看个人取舍，我一般使用
MathJax，这个引擎渲染的范围广一点，使用的也比较多。至于语法，添加
<code>--mathjax</code> 即可。还可以添加网址，例如
<code>--mathjax=URL</code>。为什么还要有网址？因为这东东是“外力”，Pandoc
不自带，它会调用内置的网址。由于这些网址都是国外的，所以很不幸可能会慢，大概率会慢，很慢。那怎么解决？其实只需下载一份
JavaScript
文件保存即可。当渲染的时候，提供路径到保存的引擎文件，没有借助网络进行渲染。</p>
<p>到 <a
target="_blank" rel="noopener" href="https://sourceforge.net/projects/mathjax.mirror/">SourceForge</a>
下载 MathJax 压缩包，解压之后重命名为 <code>MathJax</code>
并移动到某一个文件夹，可以放到
<code>/home/chunshuyumao/Documents/Pandoc/</code> 。</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120155048.png" srcset="/img/loading.gif" lazyload
alt="SourceForge" /></p>
<p>放好之后使用指定位置，现在我们的命令行如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ pandoc -s \<br>  -M title=<span class="hljs-string">&quot;Convert from Markdown to HTML&quot;</span> \<br>  -M link-citations=<span class="hljs-literal">true</span> \<br>  -M figPrefix=<span class="hljs-string">&quot;图&quot;</span> \<br>  -M figureTitle=<span class="hljs-string">&quot;图&quot;</span> \<br>  -M tblPrefix=<span class="hljs-string">&quot;表&quot;</span> \<br>  -M tableTitle=<span class="hljs-string">&quot;表&quot;</span> \<br>  -M eqnPrefix=<span class="hljs-string">&quot;公式&quot;</span> \<br>  -N \<br>  --mathjax=/home/chunshuyumao/Documents/Pandoc/MathJax/es5/tex-mml-chtml.js \<br>  --filter pandoc-crossref \<br>  --citeproc \<br>  --bibliography /path/to/lib.json \<br>  --csl /path/to/style.csl \<br>  test.md \<br>  -o test.html<br></code></pre></div></td></tr></table></figure>
<p>不下载其实也可以用，就是看个人网络问题。如果不下载，就只需要加
<code>--mathjax</code>。</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120155705.png" srcset="/img/loading.gif" lazyload
alt="数学公式渲染" /></p>
<h2 id="论文-docx-模板">论文 DOCX 模板</h2>
<p>刚开始时我们就发现生成的 DOCX
好像不咋地，且写论文一般有要求，例如字号、字体等，靠 Pandoc
默认的模板很难满足需求，我们需要自己的模板。Pandoc 考虑到了，提供
<code>reference-doc</code> 引入模板。</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120160438.png" srcset="/img/loading.gif" lazyload
alt="reference-doc 引入 DOCX 模板" /></p>
<h3 id="导出-pandoc-默认模板">导出 Pandoc 默认模板</h3>
<p>首先导出 Pandoc 模板，它预设了很多格式，直接修改即可。使用 Windows
系统需要注意，这一步的导出只能使用 CMD，不可使用
Powershell，后者会出现乱码。在命令行中输入：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ pandoc --print-defatul-data-file ref.docx &gt; ref.docx<br></code></pre></div></td></tr></table></figure>
<p>用 WPS 或者 Office 打开，看看预设的模板如何：</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120160858.png" srcset="/img/loading.gif" lazyload
alt="获取模板，并打开" /></p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120161032.png" srcset="/img/loading.gif" lazyload
alt="打开木板预览" /></p>
<p>没有表格对应的模板，所以三线表需要导出成 DOCX 后再手动进行修改。修改
DOCX 模板不在本篇文章的范围，所以大家最好自己去试。</p>
<p>修改之后的模板也放到
<code>/home/chunshuyumao/Documents/Pandoc/</code>
下边，待会再放个大招。</p>
<h3 id="使用自己的模板">使用自己的模板</h3>
<p>假设已修改完模板可以使用了。这个模板只有 DOCX 使用，所以导出成 HTML
就不必加入了。语法是
<code>--reference-doc=/path/to/template.docx</code>。下面导出我们的文档看看。</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ pandoc \<br>  -M title=<span class="hljs-string">&quot;Convert from Markdown to HTML&quot;</span> \<br>  -M link-citations=<span class="hljs-literal">true</span> \<br>  -M figPrefix=<span class="hljs-string">&quot;图&quot;</span> \<br>  -M figureTitle=<span class="hljs-string">&quot;图&quot;</span> \<br>  -M tblPrefix=<span class="hljs-string">&quot;表&quot;</span> \<br>  -M tableTitle=<span class="hljs-string">&quot;表&quot;</span> \<br>  -M eqnPrefix=<span class="hljs-string">&quot;公式&quot;</span> \<br>  -N \<br>  --reference-doc=/home/chunshuyumao/Documents/Pandoc/paper.docx<br>  --mathjax=/home/chunshuyumao/Documents/Pandoc/MathJax/es5/tex-mml-chtml.js \<br>  --filter pandoc-crossref \<br>  --citeproc \<br>  --bibliography /path/to/lib.json \<br>  --csl /path/to/style.csl \<br>  test.md \<br>  -o test.docx<br></code></pre></div></td></tr></table></figure>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120161832.png" srcset="/img/loading.gif" lazyload
alt="按照本业论文格式改的效果" /></p>
<p>大功告成！现在 Pandoc
已经被驯服了。不过这还不算完善，每次要写这么长的命令，鬼才乐意。接下来就是如何优化的
Pandoc 配置。</p>
<h2 id="优化-pandoc-配置">优化 Pandoc 配置</h2>
<p>优化配置还得看官网。官网说我们可以使用一个 YAML 格式配置选项和
<code>metadata</code> 然后让 Pandoc 读取。YAML
是什么不用担心，就是一个标记语言，是 "YAML Ain't a Markup Language"
的递归缩写。这是开源世界的一种玩笑，很明显这就是一个标记语言，所以实际上它叫做
"Yet Another Markup Language"。YAML
可以清晰明了地展示配置。闲话少叙，直接看这是如何使用.</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120162426.png" srcset="/img/loading.gif" lazyload
alt="配置" /></p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120163224.png" srcset="/img/loading.gif" lazyload
alt="Pandoc 配置" /></p>
<p>官网上有如何配置和默认的配置信息，我们只需要修改一些即可。首先祭出我们又臭又长的命令行参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ pandoc \<br>  -M title=<span class="hljs-string">&quot;Convert from Markdown to HTML&quot;</span> \<br>  -M link-citations=<span class="hljs-literal">true</span> \<br>  -M figPrefix=<span class="hljs-string">&quot;图&quot;</span> \<br>  -M figureTitle=<span class="hljs-string">&quot;图&quot;</span> \<br>  -M tblPrefix=<span class="hljs-string">&quot;表&quot;</span> \<br>  -M tableTitle=<span class="hljs-string">&quot;表&quot;</span> \<br>  -M eqnPrefix=<span class="hljs-string">&quot;公式&quot;</span> \<br>  -N \<br>  --reference-doc=/home/chunshuyumao/Documents/Pandoc/paper.docx<br>  --mathjax=/home/chunshuyumao/Documents/Pandoc/MathJax/es5/tex-mml-chtml.js \<br>  --filter pandoc-crossref \<br>  --citeproc \<br>  --bibliography /path/to/lib.json \<br>  --csl /path/to/style.csl \<br>  test.md \<br>  -o test.docx<br></code></pre></div></td></tr></table></figure>
<h3 id="metadata-yaml-文件">MetaData YAML 文件</h3>
<p><code>-M</code> 开头的都是 <code>metadata</code> ，所有创建一个
<code>meta.yaml</code> 文件，把它们写进去，<code>#</code>
开头的是注释，方便注释参数的作用。YAML
使用冒号而不是等号，而且冒号之后还得有一个空格。</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-comment"># -------------------------------------------------------------</span><br><span class="hljs-comment"># Pandoc-crossref</span><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><br><span class="hljs-attr">figPrefix:</span> <span class="hljs-string">&quot;图&quot;</span><br><span class="hljs-attr">figureTitle:</span> <span class="hljs-string">&quot;图&quot;</span><br><br><span class="hljs-attr">tblPrefix:</span> <span class="hljs-string">&quot;表&quot;</span><br><span class="hljs-attr">tableTitle:</span> <span class="hljs-string">&quot;表&quot;</span><br><br><span class="hljs-attr">eqnPrefix:</span> <span class="hljs-string">&quot;公式&quot;</span><br><br><span class="hljs-comment"># 支持交叉引用跳转</span><br><span class="hljs-attr">linkReference:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><span class="hljs-comment"># Division</span><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><span class="hljs-attr">chapters:</span> <span class="hljs-literal">true</span><br><br><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><span class="hljs-comment"># Citations</span><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><span class="hljs-attr">link-citations:</span> <span class="hljs-literal">true</span><br><span class="hljs-comment"># 不需要将参考文献做成连接</span><br><span class="hljs-attr">link-bibliography:</span> <span class="hljs-literal">false</span><br><span class="hljs-comment"># 参考文献</span><br><span class="hljs-attr">reference-section-title:</span> <span class="hljs-string">&quot;参考文献&quot;</span><br><br><span class="hljs-comment"># 这是 HTML 字体大小。默认字体太大了，改小一点，15、16 均可</span><br><span class="hljs-attr">fontsize:</span> <span class="hljs-string">14px</span><br></code></pre></div></td></tr></table></figure>
<p>这里多了之前没有讲的东西。首先是
<code>linkReference</code>，用于支持交叉引用跳转，默认没有开启，需要配置。<code>link-bibliography</code>
不让 Pandoc 给参考文献加上链接。这个说起来比较抽象，图片伺候：</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120164411.png" srcset="/img/loading.gif" lazyload
alt="加链接" /></p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120164244.png" srcset="/img/loading.gif" lazyload
alt="不加链接" /></p>
<p>最后一行是参考文献标题大名。有人可能发现了，<code>title</code>
没有出现在 meta.yaml 里。确实，因为没有必要，除了将
<code>metadata</code> 写到 meta.yaml 外还可在 Markdown
文件中直接写，使用 <code>---</code> 隔开即可，这叫做
<code>front-matter</code>(标头)，比如我们的原文件：</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120171326.png" srcset="/img/loading.gif" lazyload
alt="标头" /></p>
<p>除了这些，所有的 <code>-M</code> 的属性都可以写到 front-matter
中。</p>
<h3 id="options-yaml-文件">Options YAML 文件</h3>
<p>写完 <code>metadata</code> 文件来看选项文件。命令行中所有非
<code>-M</code>
都是选项。注意，之前转换格式时少了一点，就是显式指定格式。实际上我们是从
Markdown 格式 转成 HTML 或者 DOCX
的。这次为了规范，我们分别为两者指定各自的文件，先写 DOCX 的 YAML
文件：</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-comment"># 指定从 Markdown 格式开始转换</span><br><span class="hljs-attr">reader:</span> <span class="hljs-string">markdown</span><br><span class="hljs-comment"># 指定转换成的格式是 DOCX</span><br><span class="hljs-attr">writer:</span> <span class="hljs-string">docx</span><br><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><span class="hljs-comment"># Reader Options</span><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><span class="hljs-comment"># 设置 Tab 为 4 个空格</span><br><span class="hljs-attr">tab-stop:</span> <span class="hljs-number">4</span><br><span class="hljs-attr">preserve-tabs:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-comment"># 使用 pandoc-crossref 作为交叉引用</span><br><span class="hljs-attr">filters:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">pandoc-crossref</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">citeproc</span><br><br><span class="hljs-comment"># 指定 metadata 从 meta.yaml 中读取</span><br><span class="hljs-attr">metadata-files:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">meta.yaml</span><br><br><span class="hljs-comment"># 设置标题偏移。例如将一级标题变成三级标题，那就改成 2</span><br><span class="hljs-attr">shift-heading-level-by:</span> <span class="hljs-number">0</span><br><span class="hljs-comment"># 设置图片默认扩展名。如果自己太懒连格式都没写，那就让 Pandoc</span><br><span class="hljs-comment"># 自动帮你添加 —— 那你是真的懒</span><br><span class="hljs-attr">default-image-extension:</span> <span class="hljs-string">.png</span><br><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><span class="hljs-comment"># Writer Options</span><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><span class="hljs-comment"># 这是设置默认结束符，Windows 可以设置为 nl</span><br><span class="hljs-attr">eol:</span> <span class="hljs-string">lf</span><br><span class="hljs-comment"># 是否自动换行。如果一行太长了，Pandoc 可以帮助自动换行</span><br><span class="hljs-attr">wrap:</span> <span class="hljs-string">auto</span><br><br><span class="hljs-comment"># 是否生成目录。</span><br><span class="hljs-attr">toc:</span> <span class="hljs-literal">false</span><br><span class="hljs-comment"># 生成目录的话，生成多深的目录，这里只需要生成二级目录就可以了</span><br><span class="hljs-attr">toc-depth:</span> <span class="hljs-number">2</span><br><br><span class="hljs-comment"># 是否是单文件模式，DOCX 可以省略，但是 HTML 最好显式写下来</span><br><span class="hljs-attr">standalone:</span> <span class="hljs-literal">true</span><br><span class="hljs-comment"># 是否去掉注释。这指的是写 Markdown 时使用的 HTML 类型的格式，例</span><br><span class="hljs-comment"># 如 &lt;!--这是注释，没必要保留到正文--&gt;</span><br><span class="hljs-attr">strip-comments:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># Fore reference-doc, metadata-files</span><br><span class="hljs-comment"># 设置查找 meta.yaml 和 模板文件的路径，设置之后就不用写很长的路</span><br><span class="hljs-comment"># 径了，不信看看上面的 meta.yaml 压根就不用写路径，这里已经设置了</span><br><span class="hljs-attr">data-dir:</span> <span class="hljs-string">/home/chunshuyumao/Documents/Pandoc</span><br><br><span class="hljs-comment"># For bibliography, and file resource</span><br><span class="hljs-comment"># 查找文献库和图片的路径</span><br><span class="hljs-attr">resource-path:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">/home/chunshuyumao/Documents/Pandoc</span><br><br><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><span class="hljs-comment"># Sepecific writer</span><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><span class="hljs-attr">reference-links:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># document | block | section</span><br><span class="hljs-attr">reference-location:</span> <span class="hljs-string">document</span><br><br><span class="hljs-comment"># default | chapter | section | part</span><br><span class="hljs-attr">top-level-division:</span> <span class="hljs-string">chapter</span><br><br><span class="hljs-attr">number-offset:</span> []<br><span class="hljs-comment"># 是否自动分章节</span><br><span class="hljs-attr">number-sections:</span> <span class="hljs-literal">true</span><br><span class="hljs-comment"># 实际上，模板找不到，所以这里还是需要写全路径</span><br><span class="hljs-attr">reference-doc:</span> <span class="hljs-string">/home/chunshuyumao/Documents/Pandoc/paper.docx</span><br><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><span class="hljs-comment"># Citation options</span><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><span class="hljs-comment"># 文献库，这里就不用写全路径了</span><br><span class="hljs-attr">bibliography:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">ZoteroLibrary.json</span><br><span class="hljs-attr">csl:</span> <span class="hljs-string">csl/chinese-gb7714-2005-numeric.csl</span><br><br></code></pre></div></td></tr></table></figure>
<p>同理，HTML 的 YAML 文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">reader:</span> <span class="hljs-string">markdown</span><br><span class="hljs-attr">writer:</span> <span class="hljs-string">html</span><br><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><span class="hljs-comment"># Reader Options</span><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><br><span class="hljs-attr">tab-stop:</span> <span class="hljs-number">4</span><br><span class="hljs-attr">preserve-tabs:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-attr">filters:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">pandoc-crossref</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">citeproc</span><br><br><span class="hljs-attr">metadata-files:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">meta.yml</span><br><br><span class="hljs-attr">shift-heading-level-by:</span> <span class="hljs-number">0</span><br><span class="hljs-attr">default-image-extension:</span> <span class="hljs-string">.png</span><br><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><span class="hljs-comment"># Writer Options</span><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><br><span class="hljs-attr">eol:</span> <span class="hljs-string">lf</span><br><span class="hljs-attr">dpi:</span> <span class="hljs-number">72</span><br><span class="hljs-attr">wrap:</span> <span class="hljs-string">auto</span><br><br><span class="hljs-attr">toc:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">toc-depth:</span> <span class="hljs-number">2</span><br><br><span class="hljs-attr">strip-comments:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-attr">standalone:</span> <span class="hljs-literal">true</span><br><span class="hljs-comment"># 这里要注意，如果为 true， 每次转换成 HTML 格式，Pandoc 都会尝试</span><br><span class="hljs-comment"># 下载 Markdown 中的图片。这种如果使用图床比较多，最好直接关了这东</span><br><span class="hljs-comment"># 东，不然转换很慢的。</span><br><span class="hljs-attr">embed-resources:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-comment"># Fore reference-doc</span><br><span class="hljs-attr">data-dir:</span> <span class="hljs-string">/home/chunshuyumao/Documents/Pandoc</span><br><br><span class="hljs-comment"># For bibliography, images</span><br><span class="hljs-attr">resource-path:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">/home/chunshuyumao/Documents/Pandoc</span><br><br><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><span class="hljs-comment"># Sepecific writer</span><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><br><span class="hljs-attr">reference-links:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># document | block | section</span><br><span class="hljs-attr">reference-location:</span> <span class="hljs-string">document</span><br><br><span class="hljs-comment"># default | chapter | section | part</span><br><span class="hljs-attr">top-level-division:</span> <span class="hljs-string">chapter</span><br><br><span class="hljs-attr">number-offset:</span> []<br><span class="hljs-attr">number-sections:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># 代码高亮的主题</span><br><span class="hljs-attr">highlight-style:</span> <span class="hljs-string">pygments</span><br><span class="hljs-comment"># 数学公式引擎</span><br><span class="hljs-attr">html-math-method:</span><br>    <span class="hljs-attr">method:</span> <span class="hljs-string">mathjax</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">/home/chunshuyumao/Documents/Pandoc/MathJax/es5/tex-mml-chtml.js</span><br><br><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><span class="hljs-comment"># Citation options</span><br><span class="hljs-comment"># -------------------------------------------------------------</span><br><br><span class="hljs-attr">bibliography:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">ZoteroLibrary.json</span><br><span class="hljs-attr">csl:</span> <span class="hljs-string">cls/chinese-gb7714-2005-numeric.csl</span><br></code></pre></div></td></tr></table></figure>
<p>把这三个文件放到 <code>/home/chunshuyumao/Documents/Pandoc/</code>
下，形成这样的结构：</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120170716.png" srcset="/img/loading.gif" lazyload
alt="文件结构" /></p>
<p>划红线的表示用不到的，有些只是我写的脚本。<code>paper.docx</code> 和
<code>ref.docx</code> 是 DOCX 模板。做好后如何用？</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ pandoc -d ~/Documents/Pandoc/defaults/docx.yaml test.md -o test.docx<br></code></pre></div></td></tr></table></figure>
<p>即可。这便是为啥建议所有东西放一个文件夹，多简单呀。至此，基本配置已经做完。但问题远远没有结束，虽然展示时没有这个毛病，但是写论文一定会碰到，那就是
CSL 文件导出的文献其实是有问题的。举个例子：</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120172424.png" srcset="/img/loading.gif" lazyload
alt="这就是毛病" /></p>
<p>作者多于三个就会使用“等”替代，但是 CSL 文件只能使用一种语言，Pandoc
的分析可能也一样，原本英文文献应该出现“et
al”，但中文本地化的前提下它只能使用“等”。这个问题不仅 Pandoc 有，Zotero
也有，主要问题出在使用 Zotero 的 CSL 文件。不用 Zotero 的 CSL
能不能避免这种情况？答案是：不知道。CSL 文件用的是 XML(Extensible Markup
Language,
可拓展标记语言)，这种标记语言简直是魔鬼，反正我是没看懂，遑论去改了。</p>
<p>这也不是没救，无法改变 CSL
文件，可以上网找别人改过的。不过我试了很多发现也没用，很可能 Pandoc
也有问题。最后曲线救国，只能写 Pandoc 的 filter
进行修改。这也是为啥我的文件夹有几个脚本。前面大家看到了，Pandoc-crossref
就是一个 Pandoc 的 filter。Pandoc filter 支持 Lua
语言，拓展不难。只是这一篇已经够长了，只能在下一篇讲如何将 Pandoc
渲染出的参考文献改为正常的词。</p>
<h1 id="后语">后语</h1>
<p>隔了大半年才再写一篇其实也是懒。期间我学五笔输入法，为了适应五笔强迫使用，结果打字速度不行，没法写文章。且最近几个月好像也不得空，期间还换了电脑系统，从
Manjaro 换成了 Arch Linux。中途遇到 Zettlr 出问题，于是从 Zettlr 迁移到
Vim。现在的 Markdown 是用 Vim 写的。当初不知道 Better BibTex for Zotero
可以在 Vim 中直接调用窗口引用文献，我甚至还写了一个 Vim
插件用于文献参考，效果如下</p>
<p><img
src="https://cdn.jsdelivr.net/gh/chunshuyumao/202203@master/20221120193841.gif" srcset="/img/loading.gif" lazyload
alt="自己写的 Vim 参考文献补全插件" /></p>
<p>感觉还行，顺便解决了 Vim
表格问题和图片插入。反正这几个月自己虽然没有写文章，但是确实没有闲着，都折腾需要折腾的东西了。如果最近要写点东西还是有素材的。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Markdown/">Markdown</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Markdown/">Markdown</a>
                    
                      <a class="hover-with-bg" href="/tags/Pandoc/">Pandoc</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/11/21/Pandoc-%E7%94%9F%E6%88%90%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%E7%9A%84-etal-%E9%97%AE%E9%A2%98/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Pandoc 生成参考文献的 etal 问题</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/06/27/Shell-%E8%84%9A%E6%9C%AC%E5%8A%A0-cURL,%E5%86%8D%E8%A7%81-PicGo/">
                        <span class="hidden-mobile">Shell 脚本加 cURL, 再见 PicGo</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
